"use strict";angular.module("sbAdminApp").controller("UserCtrl",function($scope,$filter,secureService,$rootScope,$location,$stateParams,Upload,$window){$scope.page=1,$scope.search="",$scope.data={},$scope.data.users=[];var users=secureService.users($scope.page,$scope.search);if(users.then(function(result){$scope.data=result}),$location.url()=="/users/"+$stateParams.userId){var user=secureService.getUser($stateParams.userId);user.then(function(data){$scope.user=data})}$scope.refresh=function(){var users=secureService.users($scope.page,$scope.search);users.then(function(result){$scope.data=result})},$scope.updateUser=function(user){user.email_verified="1"==user.email_verified?1:0,user.phone_verified="1"==user.phone_verified?1:0,user.creci_verified="1"==user.creci_verified?1:0,$.ajax({type:"POST",url:"http://54.213.179.207/homerapi/admin/users/"+user.id,headers:{Authorization:localStorage.getItem("Token")},data:user}).done(function(data){$scope.user=data})},$scope.deleteUser=function(user){$window.confirm("Are you absolutely sure you want to delete?")&&$.ajax({type:"DELETE",url:"http://54.213.179.207/homerapi/admin/users/"+user.id,headers:{Authorization:localStorage.getItem("Token")}}).done(function(data){window.location.reload()})},$scope.deletePost=function(post){$.ajax({type:"DELETE",url:"http://54.213.179.207/homerapi/admin/posts/"+post.id,headers:{Authorization:localStorage.getItem("Token")}}).done(function(data){window.location.reload()})},$scope.uploadCreci=function(user){Upload.upload({type:"POST",url:"http://54.213.179.207/homerapi/admin/images",data:{image:user.creci,type:"creci"},headers:{Authorization:localStorage.getItem("Token")}}).then(function(resp){user.creci=resp.data.path})},$scope.uploadAvatar=function(user){Upload.upload({type:"POST",url:"http://54.213.179.207/homerapi/admin/images",data:{image:user.avatar,type:"avatar"},headers:{Authorization:localStorage.getItem("Token")}}).then(function(resp){user.avatar=resp.data.path})},$scope.searchUser=function(q){$scope.search=q,$scope.page=1;var users=secureService.users($scope.page,$scope.search);users.then(function(result){$scope.data=result})}});